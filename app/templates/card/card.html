{% extends 'base.html' %}
{% block title %}
<title>Корзина</title>
{% endblock title %}
{% block body %}
<nav class="navbar navbar-expand-sm navbar-dark bg-dark" aria-label="Third navbar example">
  <div class="container-fluid">
    <a class="navbar-brand m-1" href="/"><span style="font-style: italic;">KSS shop</span></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample03" aria-controls="navbarsExample03" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarsExample03">
      <ul class="navbar-nav me-auto mb-2 mb-sm-0 ms-5">
        <li class="nav-item">
          <a class="nav-link" aria-current="page" href="/">Главная</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">Контакты</a>
        </li>         
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="/" id="dropdown03" data-bs-toggle="dropdown" aria-expanded="false">Товары</a>
          <ul class="dropdown-menu" aria-labelledby="dropdown03">
            <li><a class="dropdown-item" href="#">Диски</a></li>
            <li><a class="dropdown-item" href="#">Легковые шины</a></li>
            <li><a class="dropdown-item" href="#">Авто товары</a></li>
          </ul>
        </li>
      </ul>           
      <a href="/admin/login" class="btn btn-outline-light m-1">
        {% if current_user.is_authenticated and current_user.has_role('admin') %}
          Админ
        {% elif current_user.is_authenticated and current_user.has_role('user')%}
          Гость
        {% else %}
          Войти        
        {% endif %}
      </a>
        <a href="/delete_items" class="btn btn-outline-danger m-1">Удалить товары из корзины</a>
        <div class="dropdown">
          <a class="btn btn btn-warning m-1 mx-5" href="/" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
            Язык
          </a>
      
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
            <li><a class="dropdown-item" href="/"><img src="static/img/ukr.png" alt=""> Українська мова</a></li>
            <li><a class="dropdown-item" href="/"><img src="static/img/rus.png" alt=""> Русский язык</a></li>
          </ul>  
        </div>        
    </div>
  </div>
</nav>

<h1 class="mt-5">Корзина:</h1>

<div class="row">
  <div class="col-12">
    <form name='card'>
      {% for key  in data['card'] %}
      
      <div class="mb-1 row">
        <label  class="col-sm-2 col-form-label">Наименование товара:</label>
        <div class="col-sm-10">
          <input type="text" readonly class="form-control-plaintext" value="{{data['card'][key]['name_of_item']}}" style="font-weight: bold;">
        </div>
      </div>
      <div class="mb-1 row">
        <label  class="col-sm-2 col-form-label">Цена за шт (UAH):</label>
        <div class="col-sm-10">
          <input name="price" type="integer" readonly class="form-control-plaintext"  value="{{data['card'][key]['price']}}">
        </div>
      </div>
      <div class="mb-1 row">
        <label  class="col-sm-2 col-form-label">Колличество:</label>
        <div class="col-sm-10">
          <input  name="amount" type="integer" readonly class="form-control-plaintext" value="{{data['card'][key]['counter']}}">
          {% with messages = get_flashed_messages() %}
                {% if messages %}
                  <ul class=flashes>
                    {% for message in messages %}
                      <li>{{ message }}</li>
                    {% endfor %}
                  </ul>
                {% endif %}
              {% endwith %}
          
        </div>
        <div>
          <a href="/plus_one_item/{{data['card'][key]['code']}}" 
            class="btn btn-info"
            style="text-decoration: none; color: white; margin-left: 13px;">
            +
          </a>
          <a href="/minus_one_item/{{data['card'][key]['code']}}" 
            class="btn btn-info"
            style="text-decoration: none; color: white;">
            -
          </a>
          <a  href="/delete_one_item/{{data['card'][key]['code']}}" 
              class="btn btn-danger mx-4" 
              style="text-decoration: none; color: white;">
              Удалить товар
          </a>
        </div>
      </div>      
      {% endfor %}      
    </form>
  </div>
</div>

<div id="order_send" class="row">
  <div class="col-6">
    <form method="post">
      <hr>
      <div class="mb-1 row">
        <label for="staticEmail" class="col-sm-2 col-form-label" style="font-weight: bold;">Всего на сумму (UAH):</label>
        <div class="col-sm-10">
          <input id="sum" name="sum" type="text" readonly class="form-control-plaintext mx-5"  value="" style="text-decoration: underline; font-weight: bold; font-size: large;">
        </div>
      </div>
      <!--<button class="btn btn-success" type="submit">Оплата онлайн</button>-->
      <button class="btn btn-success" type="submit">Далее</button>
    </form>
    <a href="/" class="btn btn-info mt-3" style="text-decoration: none; color: white;">Ещё не всё:)</a>
  </div>
</div>
<script type="text/javascript"> 
  var full_amount = document.getElementsByName('amount');
  var prices = document.getElementsByName('price');
  var sum = document.getElementById('sum');
  var sum_matrix = [];

  for (var i = 0; i < full_amount.length; i++) {
    var s = full_amount[i].value *  prices[i].value;
    sum_matrix.push(s);
  }
  var sum_el = 0;
  for (let index = 0; index < sum_matrix.length; index++) {
    sum_el = sum_el +sum_matrix[index];    
  }
  sum.value = parseFloat(sum_el).toFixed(2);
</script>
{% endblock body %}

